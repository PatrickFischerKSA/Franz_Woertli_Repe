<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Deutsch â†’ FranzÃ¶sisch â€“ Quiz</title>
<style>
body{font-family:system-ui,sans-serif;background:#f6f6f6;padding:2rem}
.card{background:#fff;padding:2rem;max-width:760px;margin:auto;border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.15)}
h1{margin-top:0}
.correct{color:green;font-weight:bold}
.wrong{color:red;font-weight:bold}
.progress-bg{background:#ddd;border-radius:10px;overflow:hidden;margin-bottom:.3rem}
#progressBar{height:18px;width:0%;background:#4caf50}
button{margin-top:.4rem}
</style>
</head>
<body>

<!-- optionale MP3-Dateien (nicht im ZIP enthalten) -->
<audio id="a50" src="avignon.mp3"></audio>
<audio id="a60" src="ton-chemin.mp3"></audio>
<audio id="a70" src="regrette-rien.mp3"></audio>
<audio id="a80" src="mon-mec.mp3"></audio>
<audio id="a90" src="marseillaise.mp3"></audio>

<div class="card">
<h1>Deutsch â†’ FranzÃ¶sisch</h1>
<button id="muteBtn" type="button">ðŸ”Š Ton an</button>

<div class="progress-bg"><div id="progressBar"></div></div>
<p id="progressText">Fortschritt: 0 %</p>

<h2 id="levelTitle"></h2>
<p id="promptText" style="font-size:1.2rem;font-weight:bold"></p>

<input id="answerInput" style="width:100%;padding:.6rem;font-size:1.1rem" autocomplete="off">
<button id="checkBtn" type="button">Antwort prÃ¼fen</button>

<p id="feedback"></p>
<p id="hint"></p>
<p id="solution"></p>

<button id="nextBtn" type="button">Weiter</button>
</div>

<script>
/* ====================== DATEN ====================== */
const LEVEL1 = [
 {de:"der Schulanfang", fr:["la rentrÃ©e"]},
 {de:"das Buch", fr:["le livre"]},
 {de:"das Heft", fr:["le cahier"]},
 {de:"der Bleistift", fr:["le crayon"]},
 {de:"der Kugelschreiber", fr:["le stylo"]},
 {de:"der Radiergummi", fr:["la gomme"]},
 {de:"die Schule", fr:["lâ€™Ã©cole"]},
 {de:"das Klassenzimmer", fr:["la salle de classe"]},
 {de:"die Pause", fr:["la rÃ©crÃ©ation"]},
 {de:"die Familie", fr:["la famille"]},
 {de:"die Mutter", fr:["la mÃ¨re"]},
 {de:"der Vater", fr:["le pÃ¨re"]},
 {de:"die Schwester", fr:["la sÅ“ur"]},
 {de:"der Bruder", fr:["le frÃ¨re"]},
 {de:"die Grosseltern", fr:["les grands-parents"]},
 {de:"Ich habe Angst.", fr:["Jâ€™ai peur."]},
 {de:"Es regnet.", fr:["Il pleut."]},
 {de:"Es ist kalt.", fr:["Il fait froid."]},
 {de:"Es ist warm.", fr:["Il fait chaud."]},
 {de:"Wir gehen ins Kino.", fr:["Nous allons au cinÃ©ma."]},
 {de:"Ich denke, dass â€¦", fr:["Je pense que â€¦","Je pense que..."]},
 {de:"Das ist keine gute Idee.", fr:["Ce nâ€™est pas une bonne idÃ©e."]},
 {de:"Ich bin nicht einverstanden.", fr:["Je ne suis pas dâ€™accord."]},
 {de:"Der Unterricht endet am Mittag.", fr:["Les cours se terminent Ã  midi."]},
 {de:"Ich habe Hunger.", fr:["Jâ€™ai faim."]},
 {de:"Es war lecker.", fr:["Câ€™Ã©tait dÃ©licieux !","Câ€™etait dÃ©licieux !","C'Ã©tait dÃ©licieux !"]}
];

const LEVEL2 = [
 {de:"Ich gehe in die Schule.", fr:["Je vais Ã  lâ€™Ã©cole."]},
 {de:"Wir gehen ins Kino.", fr:["Nous allons au cinÃ©ma."]},
 {de:"Er ist ins Kino gegangen.", fr:["Il est allÃ© au cinÃ©ma."]},
 {de:"Wir haben einen Film gesehen.", fr:["Nous avons regardÃ© un film."]},
 {de:"Sie hatte Hunger.", fr:["Elle a eu faim."]},
 {de:"Der Unterricht hat am Mittag geendet.", fr:["Les cours se sont terminÃ©s Ã  midi."]},
 {de:"Ich habe gedacht, dass â€¦", fr:["Jâ€™ai pensÃ© que â€¦","J'ai pensÃ© que ..."]},
 {de:"Es hat geregnet.", fr:["Il a plu."]}
];

/* ====================== UI HOOKS ====================== */
const el = {
  muteBtn: document.getElementById('muteBtn'),
  progressBar: document.getElementById('progressBar'),
  progressText: document.getElementById('progressText'),
  levelTitle: document.getElementById('levelTitle'),
  promptText: document.getElementById('promptText'),
  answerInput: document.getElementById('answerInput'),
  checkBtn: document.getElementById('checkBtn'),
  nextBtn: document.getElementById('nextBtn'),
  feedback: document.getElementById('feedback'),
  hint: document.getElementById('hint'),
  solution: document.getElementById('solution')
};

const audios = {
  50: document.getElementById('a50'),
  60: document.getElementById('a60'),
  70: document.getElementById('a70'),
  80: document.getElementById('a80'),
  90: document.getElementById('a90')
};

/* ====================== LOGIK ====================== */
let level = 1;
let data = shuffle(LEVEL1.slice());
let index = 0;
let attempts = 0;
let correct = 0;
let total = 0;
let muted = false;

function normalize(s){
  return (s ?? '').toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[â€™']/g,"'")
    .replace(/\s+/g,' ')
    .trim();
}

function show(){
  attempts = 0;
  el.feedback.textContent = '';
  el.hint.textContent = '';
  el.solution.textContent = '';
  el.levelTitle.textContent = (level === 1) ? 'Level 1 â€“ Wortschatz' : 'Level 2 â€“ Transfer';
  el.promptText.textContent = data[index].de;
  el.answerInput.value = '';
  el.answerInput.focus();
}

function updateProgress(){
  const p = total ? Math.round((correct/total)*100) : 0;
  el.progressBar.style.width = p + '%';
  el.progressText.textContent = `Fortschritt: ${p} %`;
}

function playFinal(){
  if (muted) return;
  const p = total ? Math.round((correct/total)*100) : 0;
  let k = null;
  if (p >= 90) k = 90;
  else if (p >= 80) k = 80;
  else if (p >= 70) k = 70;
  else if (p >= 60) k = 60;
  else if (p >= 50) k = 50;

  if (k){
    Object.values(audios).forEach(a => { try{a.pause(); a.currentTime=0;}catch(e){} });
    audios[k].play().catch(()=>{});
  }
}

function checkAnswer(){
  const user = normalize(el.answerInput.value);
  const sols = data[index].fr.map(normalize);

  if (sols.includes(user)){
    el.feedback.textContent = 'âœ“ Richtig';
    el.feedback.className = 'correct';
    correct++; total++;
    updateProgress();
  } else {
    attempts++;
    el.feedback.textContent = 'âœ— Falsch';
    el.feedback.className = 'wrong';

    if (attempts === 2){
      el.hint.textContent = 'Hinweis: Artikel, Verbform, Akzente beachten.';
    }
    if (attempts >= 3){
      el.solution.textContent = 'LÃ¶sung: ' + data[index].fr[0];
      total++;
      updateProgress();
    }
  }
}

function nextItem(){
  index++;
  if (index >= data.length){
    // Musik erst NACH Level-Abschluss
    playFinal();

    if (level === 1){
      level = 2;
      data = shuffle(LEVEL2.slice());
      index = 0;
      alert('Level 2 â€“ Transfer startet');
    } else {
      alert('Quiz beendet ðŸŽ‰');
      return;
    }
  }
  show();
}

function toggleMute(){
  muted = !muted;
  el.muteBtn.textContent = muted ? 'ðŸ”‡ Ton aus' : 'ðŸ”Š Ton an';
  if (muted){
    Object.values(audios).forEach(a => { try{a.pause(); a.currentTime=0;}catch(e){} });
  }
}

function shuffle(arr){
  for (let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* ====================== EVENTS ====================== */
el.checkBtn.addEventListener('click', checkAnswer);
el.nextBtn.addEventListener('click', nextItem);
el.muteBtn.addEventListener('click', toggleMute);
el.answerInput.addEventListener('keydown', (e)=>{
  if (e.key === 'Enter') checkAnswer();
});

show();
</script>
</body>
</html>
